<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Terraform - 100 Days Of Kubernetes</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">Overview</li><li class="chapter-item expanded "><a href="../overview.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../contributors.html"><strong aria-hidden="true">2.</strong> Contributors</a></li><li class="chapter-item expanded affix "><li class="part-title">Let's get started</li><li class="chapter-item expanded "><a href="../start/intro-to-k8s.html"><strong aria-hidden="true">3.</strong> Introduction to Kubernetes</a></li><li class="chapter-item expanded "><a href="../start/architecture-overview.html"><strong aria-hidden="true">4.</strong> Kubernetes Architecture</a></li><li class="chapter-item expanded "><a href="../start/pods.html"><strong aria-hidden="true">5.</strong> Kubernetes Pods</a></li><li class="chapter-item expanded "><a href="../start/set-up-cluster.html"><strong aria-hidden="true">6.</strong> Setup Kubernetes Cluster</a></li><li class="chapter-item expanded "><a href="../start/run-pod.html"><strong aria-hidden="true">7.</strong> Run Pods</a></li><li class="chapter-item expanded "><a href="../start/replicas.html"><strong aria-hidden="true">8.</strong> Replica Set</a></li><li class="chapter-item expanded "><a href="../start/deployment.html"><strong aria-hidden="true">9.</strong> Kubernetes Deployment</a></li><li class="chapter-item expanded "><a href="../start/namespaces.html"><strong aria-hidden="true">10.</strong> Namespaces</a></li><li class="chapter-item expanded "><a href="../start/configmaps.html"><strong aria-hidden="true">11.</strong> ConfigMaps</a></li><li class="chapter-item expanded affix "><li class="part-title">Networking</li><li class="chapter-item expanded "><a href="../networking/service.html"><strong aria-hidden="true">12.</strong> Kubernetes Service</a></li><li class="chapter-item expanded "><a href="../networking/ingress.html"><strong aria-hidden="true">13.</strong> Kubernetes Ingress</a></li><li class="chapter-item expanded "><a href="../networking/servicemesh.html"><strong aria-hidden="true">14.</strong> Service Mesh</a></li><li class="chapter-item expanded affix "><li class="part-title">Storage</li><li class="chapter-item expanded "><a href="../storage/volumes.html"><strong aria-hidden="true">15.</strong> Kubernetes Volumes</a></li><li class="chapter-item expanded affix "><li class="part-title">Kubernetes Clusters Overview and Use</li><li class="chapter-item expanded "><a href="../kubernetes-clusters/kind.html"><strong aria-hidden="true">16.</strong> KinD Cluster</a></li><li class="chapter-item expanded "><a href="../kubernetes-clusters/k3s.html"><strong aria-hidden="true">17.</strong> K3s and K3sup</a></li><li class="chapter-item expanded affix "><li class="part-title">Templating & IaC</li><li class="chapter-item expanded "><a href="../templating/kustomize.html"><strong aria-hidden="true">18.</strong> Kustomize</a></li><li class="chapter-item expanded "><a href="../templating/terraform.html" class="active"><strong aria-hidden="true">19.</strong> Terraform</a></li><li class="chapter-item expanded "><a href="../templating/crossplane.html"><strong aria-hidden="true">20.</strong> Crossplane</a></li><li class="chapter-item expanded affix "><li class="part-title">Helm</li><li class="chapter-item expanded "><a href="../helm/partone.html"><strong aria-hidden="true">21.</strong> Helm Part 1</a></li><li class="chapter-item expanded "><a href="../helm/partwo.html"><strong aria-hidden="true">22.</strong> Helm Part 2</a></li><li class="chapter-item expanded "><a href="../helm/partthree.html"><strong aria-hidden="true">23.</strong> Helm Part 3</a></li><li class="chapter-item expanded affix "><li class="part-title">Cloud Native Tools and Platforms</li><li class="chapter-item expanded "><a href="../tools/k9s.html"><strong aria-hidden="true">24.</strong> k9s</a></li><li class="chapter-item expanded "><a href="../tools/knative.html"><strong aria-hidden="true">25.</strong> Knative</a></li><li class="chapter-item expanded "><a href="../tools/argo.html"><strong aria-hidden="true">26.</strong> GitOps and Argo</a></li><li class="chapter-item expanded "><a href="../tools/linkerd.html"><strong aria-hidden="true">27.</strong> Linkerd</a></li><li class="chapter-item expanded affix "><li class="part-title">Observability</li><li class="chapter-item expanded "><a href="../observaility/prometheus.html"><strong aria-hidden="true">28.</strong> Prometheus</a></li><li class="chapter-item expanded "><a href="../observability/prometheus-exporter.html"><strong aria-hidden="true">29.</strong> Prometheus Exporter</a></li><li class="chapter-item expanded affix "><li class="part-title">Advanced Topics</li><li class="chapter-item expanded "><a href="../advanced/operators.html"><strong aria-hidden="true">30.</strong> Kubernetes Operators</a></li><li class="chapter-item expanded affix "><li class="part-title">Tutorials and Practice</li><li class="chapter-item expanded "><a href="../tutorials/serverless.html"><strong aria-hidden="true">31.</strong> Serverless</a></li><li class="chapter-item expanded "><a href="../tutorials/ingress-from-scratch.html"><strong aria-hidden="true">32.</strong> Ingress from scratch</a></li><li class="chapter-item expanded "><a href="../tutorials/istio-from-scratch.html"><strong aria-hidden="true">33.</strong> Istio from scratch</a></li><li class="chapter-item expanded "><a href="../tutorials/deploy-to-civo.html"><strong aria-hidden="true">34.</strong> Deploy to CIVO</a></li><li class="chapter-item expanded affix "><li class="part-title">Troubleshooting K8s</li><li class="chapter-item expanded "><a href="../troubleshooting/crashloopbackoff.html"><strong aria-hidden="true">35.</strong> CrashLoopBackOff</a></li><li class="chapter-item expanded affix "><li class="part-title">Glossary</li><li class="chapter-item expanded "><a href="../glossary/terminologyprimer.html"><strong aria-hidden="true">36.</strong> Terminology Primer</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">100 Days Of Kubernetes</h1>

                    <div class="right-buttons">
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        <a href="https://github.com/100daysofkubernetes/100DaysOfKubernetes" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="terraform"><a class="header" href="#terraform">Terraform</a></h1>
<h1 id="100days-resources"><a class="header" href="#100days-resources">100Days Resources</a></h1>
<ul>
<li><a href="https://youtu.be/pbrsrKFhohk">Video by Anais Urlichs</a></li>
<li>Add your blog posts, videos etc. related to the topic here!</li>
</ul>
<h1 id="learning-resources"><a class="header" href="#learning-resources">Learning Resources</a></h1>
<ul>
<li><a href="https://youtu.be/UleogrJkZn0">https://youtu.be/UleogrJkZn0</a></li>
<li><a href="https://youtu.be/HmxkYNv1ksg">https://youtu.be/HmxkYNv1ksg</a></li>
<li><a href="https://youtu.be/l5k1ai_GBDE">https://youtu.be/l5k1ai_GBDE</a></li>
<li><a href="https://learn.hashicorp.com/tutorials/terraform/kubernetes-provider?in=terraform/use-case">https://learn.hashicorp.com/tutorials/terraform/kubernetes-provider?in=terraform/use-case</a></li>
<li><a href="https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs/guides/getting-started">https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs/guides/getting-started</a></li>
</ul>
<h1 id="example-notes"><a class="header" href="#example-notes">Example Notes</a></h1>
<p>With Terraform, you have a DevOps first approach. It is an open-source tools, original developed by <a href="https://www.hashicorp.com/">HashiCorp</a></p>
<p>It is an infrastructure provisioning tool that allows you to store your infrastructure set-up as code.</p>
<p>Normally, you would have:</p>
<ol>
<li>Provisioning the Infrastructure
<ol>
<li>Usually has top be done within a specific order</li>
</ol>
</li>
<li>Deploying the application</li>
</ol>
<p>It has a strong open community and is pluggable by design — meaning that it is used by vast number of organisations</p>
<p>Allows you to manage your infrastructure as code in a declarative format. </p>
<p>What would be the alternative?</p>
<ul>
<li>Pressing buttons in a UI — the problem with this is that it is not repeatable across machines</li>
</ul>
<p>Especially important in the microservices world! It would otherwise be more time-consuming and error-prone to set-up all the resources needed for every microservice.</p>
<p>What is a declarative approach?</p>
<p>Current state vs. desired state</p>
<p>Define what the end-result should be.</p>
<p>When you are first defining your resources, this is less needed. However, once you are adding or changing resources, this is a lot more important. It does not require you to know how many resources and what resources are currently available but it will just compare what is the current state and what has to happen to create the desired state.</p>
<p><strong>Different stages of using Terraform:</strong></p>
<ol>
<li>Terraform file that defines our resources e.g. VM, Kubernetes cluster, VPC</li>
<li>Plan Phase — Terraform command: Compares the desired state to what currently exists on our cluster
if everything looks good:</li>
<li>Apply Phase: Terraform is using your API token to spin up your resources</li>
</ol>
<p>When you defined your Terraform resources, you define a provider: </p>
<p>Connects you to a cloud provider/infrastructure provider. A provider can also be used to spin up platforms and manage SAAS offerings</p>
<p>So, beyond IAAS, you can also manage other platforms and resources through Terraform.</p>
<p>You can configure your provider in either of the following ways:</p>
<ol>
<li>Use cloud-specific auth plugins (for example, <code>eks get-token</code>, <code>az get-token</code>, <code>gcloud config</code>)</li>
<li>Use <a href="https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs/guides/getting-started#provider-setup">oauth2 token</a></li>
<li>Use <a href="https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs#statically-defined-credentials">TLS certificate credentials</a></li>
<li>Use <code>kubeconfig</code> file by setting <strong>both</strong> <code>[config_path](https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs#config_path)</code> and <code>[config_context](https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs#config_context)</code></li>
<li>Use <a href="https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs#statically-defined-credentials">username and password (HTTP Basic Authorization)</a></li>
</ol>
<h2 id="lets-try-out-terraform"><a class="header" href="#lets-try-out-terraform">Let's try out Terraform</a></h2>
<ol>
<li><a href="https://learn.hashicorp.com/tutorials/terraform/install-cli?in=terraform/aws-get-started">Install Terraform</a></li>
<li>Initialise cloud provider</li>
<li>Run &quot;terraform init&quot;</li>
<li>Set-up a security group</li>
<li>Make sure that you set up the file</li>
<li>Try whether or not it works with &quot;terraform plan&quot; . Here we would expect something to add but not necessarily something to change or to destroy.</li>
<li>Don't display your credentials openly, you would probably want to use something like Ansible vault or similar to store your credentials, do not store in plain text</li>
<li>Once we have finished setting up our resources, we want to destroy them &quot;terraform destroy&quot;</li>
</ol>
<p>tf is the file extension that Terraform uses</p>
<p>Note that you can find all available information on a data source.</p>
<p>Common question: What is the difference between Ansible and Terraform</p>
<ol>
<li>They are both used for provisioning the infrastructure</li>
<li>However, Terraform also has the power to provision the infrastructure</li>
<li>Ansible is better for configuring the infrastructure and deploying the application</li>
<li>Both could be used in combination</li>
</ol>
<p>I am doing this example on my local kind cluster — have a look at one of the previous videos to see how to set-up kind</p>
<p>We are using a mixture of the following tutorials</p>
<ul>
<li><a href="https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs/guides/getting-started">https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs/guides/getting-started</a></li>
<li><a href="https://learn.hashicorp.com/tutorials/terraform/kubernetes-provider?in=terraform/use-case">https://learn.hashicorp.com/tutorials/terraform/kubernetes-provider?in=terraform/use-case</a></li>
</ul>
<p>Create your cluster e.g. with kind</p>
<p>kind-config.yaml</p>
<pre><code class="language-jsx">kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
  extraPortMappings:
  - containerPort: 30201
    hostPort: 30201
    listenAddress: &quot;0.0.0.0&quot;
</code></pre>
<p>Then run</p>
<pre><code class="language-jsx">kind create cluster --name terraform-learn --config kind-config.yaml
</code></pre>
<p>For our terraform.tfvar file, we need the following information </p>
<ul>
<li><code>[host](https://learn.hashicorp.com/tutorials/terraform/kubernetes-provider?in=terraform/use-case#host)</code> corresponds with <code>clusters.cluster.server</code>.</li>
<li><code>[client_certificate](https://learn.hashicorp.com/tutorials/terraform/kubernetes-provider?in=terraform/use-case#client_certificate)</code> corresponds with <code>users.user.client-certificate</code>.</li>
<li><code>[client_key](https://learn.hashicorp.com/tutorials/terraform/kubernetes-provider?in=terraform/use-case#client_key)</code> corresponds with <code>users.user.client-key</code>.</li>
<li><code>[cluster_ca_certificate](https://learn.hashicorp.com/tutorials/terraform/kubernetes-provider?in=terraform/use-case#cluster_ca_certificate)</code> corresponds with <code>clusters.cluster.certificate-authority-data</code>.</li>
</ul>
<p>To get those, run:
&quot;kubectl config view --minify --flatten --context=kind-terraform-learn&quot;</p>
<pre><code class="language-jsx"># terraform.tfvars

host                   = &quot;https://127.0.0.1:32768&quot;
client_certificate     = &quot;LS0tLS1CRUdJTiB...&quot;
client_key             = &quot;LS0tLS1CRUdJTiB...&quot;
cluster_ca_certificate = &quot;LS0tLS1CRUdJTiB...&quot;
</code></pre>
<p>This is our terraform .tf file</p>
<pre><code class="language-jsx">terraform {
  required_providers {
    kubernetes = {
      source = &quot;hashicorp/kubernetes&quot;
    }
  }
}

variable &quot;host&quot; {
  type = string
}

variable &quot;client_certificate&quot; {
  type = string
}

variable &quot;client_key&quot; {
  type = string
}

variable &quot;cluster_ca_certificate&quot; {
  type = string
}

provider &quot;kubernetes&quot; {
  host = var.host

  client_certificate     = base64decode(var.client_certificate)
  client_key             = base64decode(var.client_key)
  cluster_ca_certificate = base64decode(var.cluster_ca_certificate)
}

resource &quot;kubernetes_namespace&quot; &quot;test&quot; {
  metadata {
    name = &quot;nginx&quot;
  }
}
resource &quot;kubernetes_deployment&quot; &quot;test&quot; {
  metadata {
    name      = &quot;nginx&quot;
    namespace = kubernetes_namespace.test.metadata.0.name
  }
  spec {
    replicas = 2
    selector {
      match_labels = {
        app = &quot;MyTestApp&quot;
      }
    }
    template {
      metadata {
        labels = {
          app = &quot;MyTestApp&quot;
        }
      }
      spec {
        container {
          image = &quot;nginx&quot;
          name  = &quot;nginx-container&quot;
          port {
            container_port = 80
          }
        }
      }
    }
  }
}
resource &quot;kubernetes_service&quot; &quot;test&quot; {
  metadata {
    name      = &quot;nginx&quot;
    namespace = kubernetes_namespace.test.metadata.0.name
  }
  spec {
    selector = {
      app = kubernetes_deployment.test.spec.0.template.0.metadata.0.labels.app
    }
    type = &quot;NodePort&quot;
    port {
      node_port   = 30201
      port        = 80
      target_port = 80
    }
  }
}
</code></pre>
<p>Now we can run</p>
<pre><code class="language-jsx">terraform init

terraform plan

terraform apply
</code></pre>
<p>Make sure that all your resources are within the right path and it should work.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../templating/kustomize.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../templating/crossplane.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../templating/kustomize.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../templating/crossplane.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
